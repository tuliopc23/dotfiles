# Yazi configuration
# Enhanced with useful features and integrations

[theme]
flavor = { use = "xcode-dark" }

[mgr]
# Layout ratio: left panel, main panel, preview panel
ratio          = [ 1, 3, 4 ]
sort_by        = "alphabetical"
sort_sensitive = false
sort_reverse   = false
sort_dir_first = true
sort_translit  = false
linemode       = "size"  # Show file sizes
show_hidden    = true
show_symlink   = true
scrolloff      = 5
mouse_events   = [ "click", "scroll" ]

[preview]
tab_size        = 2
max_width       = 1000
max_height      = 1000
cache_dir       = ""
# Image preview settings
image_delay     = 30
image_filter    = "triangle"
image_quality   = 80
ueberzug_scale  = 1
ueberzug_offset = [ 0, 0, 0, 0 ]

[opener]
# macOS-specific openers
edit = [
        { run = 'nvim "$@"', block = true },
]
open = [
        { run = 'open "$@"', desc = "Open", for = "macos" },
]
reveal = [
        { run = 'open -R "$1"', desc = "Reveal in Finder", for = "macos" },
]
extract = [
        { run = 'ya pub extract --list "$@"', desc = "Extract here", for = "unix" },
]
play = [
        { run = 'mpv --force-window "$@"', orphan = true, for = "unix" },
]

[open]
rules = [
        # Folder
        { url = "*/", use = [ "edit", "open", "reveal" ] },

        # Text files
        { mime = "text/*", use = [ "edit", "reveal" ] },

        # Images
        { mime = "image/*", use = [ "open", "reveal" ] },

        # Media
        { mime = "{audio,video}/*", use = [ "play", "reveal" ] },

        # Archives
        { mime = "application/{zip,rar,7z*,tar,gzip,xz,zstd,bzip*}", use = [ "extract", "reveal" ] },

        # JSON
        { mime = "application/{json,ndjson}", use = [ "edit", "reveal" ] },
        { mime = "*/javascript", use = [ "edit", "reveal" ] },

        # Fallback
        { url = "*", use = [ "open", "reveal" ] },
]

[tasks]
micro_workers    = 10
macro_workers    = 10
bizarre_retry    = 3
image_alloc      = 536870912  # 512MB
image_bound      = [ 5000, 5000 ]
suppress_preload = false

[plugin]

prepend_fetchers = [
        { id = "git", url = "*", run = "git" },
        { id = "git", url = "*/", run = "git" },
        { id = "mactag", url = "*", run = "mactag" },
        { id = "mactag", url = "*/", run = "mactag" },
	{ id = "mime", url = "*", run = "mime-ext.local", prio = "high" },
]

fetchers = [
	{ id = "mime", url = "*", run = "mime-ext.remote", prio = "high" },
]

# Standard Previewers (DuckDB removed)
previewers = [
        { url = "*/", run = "folder" },
        { mime = "text/*", run = "code" },
        { mime = "application/{json,ndjson}", run = "json" },
        { mime = "image/*", run = "image" },
        { mime = "video/*", run = "video" },
        { mime = "application/pdf", run = "pdf" },
        { url = "*", run = "file" },
]

prepend_previewers = [
  # Use Glow for markdown rendering
  { url = "*.md", run = 'piper -- CLICOLOR_FORCE=1 glow -w=$w -s=dark "$1"' },
]

prepend_preloaders = [
  # Removed DuckDB preloaders
]
